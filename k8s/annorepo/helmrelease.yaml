apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: annorepo
  namespace: nde
spec:
  serviceAccountName: nde
  interval: 30m
  chart:
    spec:
      chart: helm/nde-app
      reconcileStrategy: Revision
      sourceRef:
        kind: GitRepository
        name: nde
  values:
    containers:
      - name: app
        image:
          repository: ghcr.io/knaw-huc/annorepo-server
          tag: "0.8.1" # {"$imagepolicy": "nde:annorepo:tag"}
        flux:
          policy:
            type: semver
            range: ">=0.8.0"
        port: 8080
        env:
          - name: AR_EXTERNAL_BASE_URL
            value: "https://annorepo.demo.netwerkdigitaalerfgoed.nl"
          - name: AR_MONGODB_URL
            value: "mongodb://annorepo-mongo:27017/"
          - name: AR_DB_NAME
            value: annorepo
    ingresses:
      - hosts:
          - annorepo.demo.netwerkdigitaalerfgoed.nl
